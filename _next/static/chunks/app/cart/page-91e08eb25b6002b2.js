(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{8235:function(e,t,r){Promise.resolve().then(r.bind(r,2689))},2689:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CartPage}});var s=r(7437),a=r(2265),n=r(1396),c=r.n(n),o=r(8681);function CartPage(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let loadCartItems=async()=>{try{let e=await o.P4.getAll();t(e)}catch(e){console.error("カートの読み込みに失敗しました:",e)}finally{n(!1)}};loadCartItems()},[]);let updateQuantity=async(r,s)=>{if(s<=0){await removeItem(r);return}try{let a=e.map(e=>e.id===r?{...e,quantity:s}:e),n=a.find(e=>e.id===r);n&&(await o.P4.add(n),t(a))}catch(e){console.error("数量の更新に失敗しました:",e)}},removeItem=async e=>{try{await o.P4.remove(e),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error("商品の削除に失敗しました:",e)}},handleCheckout=async()=>{if(0===e.length){alert("カートが空です");return}try{let r={id:"ORD-".concat(Date.now()),customerName:"ゲストユーザー",customerEmail:"guest@example.com",items:e,total:getTotalPrice()+500,status:"pending",date:new Date().toISOString().split("T")[0],shippingAddress:"住所未設定"};await o._9.add(r),await o.P4.clear(),t([]),alert("注文が完了しました！注文番号: ".concat(r.id))}catch(e){console.error("注文の処理に失敗しました:",e),alert("注文の処理に失敗しました")}},getTotalPrice=()=>e.reduce((e,t)=>e+t.price*t.quantity,0),getTotalItems=()=>e.reduce((e,t)=>e+t.quantity,0),getCategoryIcon=e=>({sake:"\uD83C\uDF76",wine:"\uD83C\uDF77",beer:"\uD83C\uDF7A",shochu:"\uD83E\uDD43",snack:"\uD83E\uDD5C"})[e]||"\uD83C\uDF76";return r?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-secondary-600",children:"カートを読み込み中..."})]})}):(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm rounded-lg mb-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between p-6",children:[(0,s.jsx)(c(),{href:"/",className:"text-3xl font-bold text-primary-600",children:"\uD83C\uDF76 酒屋"}),(0,s.jsxs)("nav",{className:"flex space-x-6",children:[(0,s.jsx)(c(),{href:"/",className:"text-secondary-600 hover:text-primary-600 transition-colors",children:"ホーム"}),(0,s.jsx)(c(),{href:"/products",className:"text-secondary-600 hover:text-primary-600 transition-colors",children:"商品一覧"}),(0,s.jsx)(c(),{href:"/diagnosis",className:"text-secondary-600 hover:text-primary-600 transition-colors",children:"お酒診断"}),(0,s.jsx)(c(),{href:"/random",className:"text-secondary-600 hover:text-primary-600 transition-colors",children:"ランダム提案"})]})]})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-secondary-700 mb-8",children:"\uD83D\uDED2 ショッピングカート"}),0===e.length?(0,s.jsxs)("div",{className:"card text-center py-12",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDED2"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-secondary-700 mb-2",children:"カートは空です"}),(0,s.jsx)("p",{className:"text-secondary-600 mb-6",children:"商品を追加してお買い物を始めましょう！"}),(0,s.jsx)(c(),{href:"/products",className:"btn-primary",children:"商品一覧を見る"})]}):(0,s.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-secondary-700 mb-6",children:["カート内商品 (",getTotalItems(),"点)"]}),(0,s.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,s.jsxs)("div",{className:"flex items-center p-4 border border-gray-200 rounded-lg",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center mr-4",children:(0,s.jsx)("span",{className:"text-2xl",children:getCategoryIcon(e.category)})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-secondary-700 mb-1",children:e.name}),(0,s.jsxs)("p",{className:"text-primary-600 font-bold",children:["\xa5",e.price.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("button",{onClick:()=>updateQuantity(e.id,e.quantity-1),className:"w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors",children:"-"}),(0,s.jsx)("span",{className:"w-8 text-center font-medium",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>updateQuantity(e.id,e.quantity+1),className:"w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors",children:"+"})]}),(0,s.jsxs)("div",{className:"ml-6 text-right",children:[(0,s.jsxs)("p",{className:"font-bold text-secondary-700 mb-2",children:["\xa5",(e.price*e.quantity).toLocaleString()]}),(0,s.jsx)("button",{onClick:()=>removeItem(e.id),className:"text-red-600 hover:text-red-700 text-sm transition-colors",children:"削除"})]})]},e.id))})]})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"card sticky top-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-secondary-700 mb-6",children:"注文サマリー"}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-secondary-600",children:["商品合計 (",getTotalItems(),"点)"]}),(0,s.jsxs)("span",{className:"font-medium",children:["\xa5",getTotalPrice().toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-secondary-600",children:"送料"}),(0,s.jsx)("span",{className:"font-medium",children:"\xa5500"})]}),(0,s.jsx)("div",{className:"border-t pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,s.jsx)("span",{children:"合計"}),(0,s.jsxs)("span",{className:"text-primary-600",children:["\xa5",(getTotalPrice()+500).toLocaleString()]})]})})]}),(0,s.jsx)("button",{onClick:handleCheckout,className:"w-full btn-primary mb-4",children:"レジに進む"}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(c(),{href:"/products",className:"text-primary-600 hover:text-primary-700 text-sm transition-colors",children:"← 買い物を続ける"})}),(0,s.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-secondary-700 mb-3",children:"配送について"}),(0,s.jsxs)("div",{className:"text-sm text-secondary-600 space-y-2",children:[(0,s.jsx)("p",{children:"\uD83D\uDCE6 通常配送: 2-3営業日"}),(0,s.jsx)("p",{children:"\uD83D\uDE9A 送料: \xa5500 (\xa55,000以上で無料)"}),(0,s.jsx)("p",{children:"\uD83D\uDCCD 全国配送対応"})]})]}),(0,s.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-secondary-700 mb-3",children:"こちらもおすすめ"}),(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[(0,s.jsx)("span",{className:"text-2xl mr-3",children:"\uD83E\uDD5C"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-secondary-700",children:"ナッツミックス"}),(0,s.jsx)("p",{className:"text-sm text-primary-600 font-bold",children:"\xa5680"})]}),(0,s.jsx)("button",{className:"text-xs bg-primary-100 text-primary-700 px-2 py-1 rounded",children:"追加"})]})})]})]})})]})]})]})}},8681:function(e,t,r){"use strict";r.d(t,{HI:function(){return c},K0:function(){return s},KJ:function(){return seedInitialData},P4:function(){return a},_9:function(){return n}});let initDB=()=>new Promise((e,t)=>{let r=indexedDB.open("SakeShopDB",1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("products")){let e=t.createObjectStore("products",{keyPath:"id"});e.createIndex("category","category",{unique:!1}),e.createIndex("name","name",{unique:!1})}if(t.objectStoreNames.contains("cart")||t.createObjectStore("cart",{keyPath:"id"}),!t.objectStoreNames.contains("orders")){let e=t.createObjectStore("orders",{keyPath:"id"});e.createIndex("status","status",{unique:!1}),e.createIndex("date","date",{unique:!1})}if(!t.objectStoreNames.contains("users")){let e=t.createObjectStore("users",{keyPath:"id"});e.createIndex("email","email",{unique:!0})}t.objectStoreNames.contains("diagnosis_history")||t.createObjectStore("diagnosis_history",{keyPath:"id",autoIncrement:!0}),t.objectStoreNames.contains("random_history")||t.createObjectStore("random_history",{keyPath:"id",autoIncrement:!0})}}),s={getAll:async()=>{let e=await initDB();return new Promise((t,r)=>{let s=e.transaction(["products"],"readonly"),a=s.objectStore("products"),n=a.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)})},add:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["products"],"readwrite"),n=a.objectStore("products"),c=n.add(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},update:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["products"],"readwrite"),n=a.objectStore("products"),c=n.put(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},delete:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["products"],"readwrite"),n=a.objectStore("products"),c=n.delete(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},getByCategory:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["products"],"readonly"),n=a.objectStore("products"),c=n.index("category"),o=c.getAll(e);o.onsuccess=()=>r(o.result),o.onerror=()=>s(o.error)})}},a={getAll:async()=>{let e=await initDB();return new Promise((t,r)=>{let s=e.transaction(["cart"],"readonly"),a=s.objectStore("cart"),n=a.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)})},add:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["cart"],"readwrite"),n=a.objectStore("cart"),c=n.put(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},remove:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["cart"],"readwrite"),n=a.objectStore("cart"),c=n.delete(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},clear:async()=>{let e=await initDB();return new Promise((t,r)=>{let s=e.transaction(["cart"],"readwrite"),a=s.objectStore("cart"),n=a.clear();n.onsuccess=()=>t(),n.onerror=()=>r(n.error)})}},n={getAll:async()=>{let e=await initDB();return new Promise((t,r)=>{let s=e.transaction(["orders"],"readonly"),a=s.objectStore("orders"),n=a.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)})},add:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["orders"],"readwrite"),n=a.objectStore("orders"),c=n.add(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},updateStatus:async(e,t)=>{let r=await initDB();return new Promise((s,a)=>{let n=r.transaction(["orders"],"readwrite"),c=n.objectStore("orders"),o=c.get(e);o.onsuccess=()=>{let e=o.result;if(e){e.status=t;let r=c.put(e);r.onsuccess=()=>s(),r.onerror=()=>a(r.error)}else a(Error("Order not found"))},o.onerror=()=>a(o.error)})}},c={save:async e=>{let t=await initDB();return new Promise((r,s)=>{let a=t.transaction(["diagnosis_history"],"readwrite"),n=a.objectStore("diagnosis_history"),c=n.add(e);c.onsuccess=()=>r(),c.onerror=()=>s(c.error)})},getHistory:async()=>{let e=await initDB();return new Promise((t,r)=>{let s=e.transaction(["diagnosis_history"],"readonly"),a=s.objectStore("diagnosis_history"),n=a.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)})}},seedInitialData=async()=>{let e=await s.getAll();if(0===e.length)for(let e of[{id:1,name:"純米大吟醸 山田錦",category:"sake",price:3500,description:"山田錦を使用した上品な味わいの純米大吟醸酒",alcoholPercent:15.5,image:"/images/sake1.jpg",tags:["日本酒","純米大吟醸","山田錦"],stock:10,pairing:["刺身","天ぷら","和食"]},{id:2,name:"本格焼酎 黒霧島",category:"shochu",price:1200,description:"さつまいもの甘みが感じられる本格焼酎",alcoholPercent:25,image:"/images/shochu1.jpg",tags:["焼酎","さつまいも","本格"],stock:15,pairing:["焼き鳥","餃子","鍋料理"]},{id:3,name:"シャルドネ 白ワイン",category:"wine",price:2800,description:"フルーティーで爽やかな白ワイン",alcoholPercent:12,image:"/images/wine1.jpg",tags:["ワイン","白ワイン","シャルドネ"],stock:8,pairing:["魚料理","チーズ","サラダ"]},{id:4,name:"クラフトビール IPA",category:"beer",price:450,description:"ホップの苦味が効いたクラフトビール",alcoholPercent:6.5,image:"/images/beer1.jpg",tags:["ビール","クラフト","IPA"],stock:20,pairing:["ピザ","ハンバーガー","スパイシー料理"]},{id:5,name:"チーズ盛り合わせ",category:"snack",price:1800,description:"3種類のチーズの盛り合わせ",alcoholPercent:0,image:"/images/cheese1.jpg",tags:["おつまみ","チーズ","盛り合わせ"],stock:12,pairing:["ワイン","日本酒","ビール"]},{id:6,name:"ナッツミックス",category:"snack",price:680,description:"4種類のナッツをミックスした人気のおつまみ",alcoholPercent:0,image:"/images/nuts1.jpg",tags:["おつまみ","ナッツ","ミックス"],stock:25,pairing:["ビール","ウイスキー","焼酎"]}])await s.add(e)}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(2265),a=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,i={},l=null,d=null;for(s in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)n.call(t,s)&&!o.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===i[s]&&(i[s]=t[s]);return{$$typeof:a,type:e,key:l,ref:d,props:i,_owner:c.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},1396:function(e,t,r){e.exports=r(8326)}},function(e){e.O(0,[326,971,472,744],function(){return e(e.s=8235)}),_N_E=e.O()}]);